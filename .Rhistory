#install.packages("rvest")
install.packages("stringr")
install.packages("ggvis")
install.packages("knitr")
install.packages("jsonlite")
rm=list(ls=()
library(tidyverse)
library(mosaic)
library(recipes)
library(openxlsx)
require("fabricatr")
require("stargazer")
require("boot")
rm(list=ls())
library(tidyverse)
library(mosaic)
library(recipes)
library(openxlsx)
require("fabricatr")
require("stargazer")
require("boot")
data <- read.xlsx("D:\\Documents\\Andres\\ANDES\\2.5\\Taller_1_BigData\\Database.xlsx",sheet="Sheet1")
data$LnIng <- log(data$y_total_m)
data$Escol <- with(data, ifelse(
maxEducLevel == 1, 0, ifelse(
maxEducLevel == 2, 2, ifelse(
maxEducLevel == 3, 6, ifelse(
maxEducLevel == 4, 7, ifelse(
maxEducLevel== 5, 12, ifelse(
maxEducLevel == 6, 13, ifelse(
maxEducLevel == 7, 19, "No data"
)
)
))))))
data_clean <- select(data, "directorio","secuencia_p","orden","clase",
"dominio","mes","estrato1","sex","age", "p6210", "maxEducLevel","regSalud","cotPension",
"sizeFirm","oficio","wap","ocu","dsi","pea","inac",	"totalHoursWorked","formal",
"informal","cuentaPropia","microEmpresa","college","Escol","y_total_m","y_total_m_ha","LnIng")
data_clean_ocu  <- subset(data_clean,data_clean$ocu == 1 & data_clean$age >= 18 & data_clean$age <= 80  &
data_clean$dominio == "BOGOTA" ) %>% drop_na()
data_clean_ocu$agesqr <- data_clean_ocu$age^2
# Experiencia
data_clean_ocu$exp <- data_clean_ocu$age-5- as.numeric(data_clean_ocu$Escol)
data_clean_ocu$exp <- with(data_clean_ocu, ifelse(
data_clean_ocu$exp < 0,0,data_clean_ocu$exp
))
## Perfil ingreso-edad: Se toma una regresión lineal que evalue la relación entre el ingreso mensual total con la edad
#y se adapta al ajuste de elevar al cuadrado la edad para encontrar un punto de inflexión.
reg1 <- lm(y_total_m~age, data_clean_ocu)
reg2 <- lm(y_total_m~age+ agesqr, data_clean_ocu)
data_clean_ocu$yhat_reg1<-predict(reg1)
data_clean_ocu$yhat_reg2<-predict(reg2)
stargazer(reg1,reg2,type="text")
plot(data_clean_ocu$age,data_clean_ocu$yhat_reg2)
plot(data_clean_ocu$age,data_clean_ocu$yhat_reg2)
ggplot(data_clean_ocu,aes(x=age,y=yhat_reg2))+
geom_line()+
theme_classic()
plot(data_clean_ocu$age,data_clean_ocu$yhat_reg2)
grahp1<-ggplot(data_clean_ocu,aes(x=age,y=yhat_reg2))+
geom_line()+
theme_classic()
save.image(grahp1,"Grahp1.png")
grahp1<-ggplot(data_clean_ocu,aes(x=age,y=yhat_reg2))+
geom_line()+
theme_classic()
save.image(grahp1,"Grahp1.png")
grahp1<-ggplot(data_clean_ocu,aes(x=age,y=yhat_reg2))+
geom_line()+
theme_classic()
plot(data_clean_ocu$age,data_clean_ocu$yhat_reg2)
grahp1<-ggplot(data_clean_ocu,aes(x=age,y=yhat_reg2))+
geom_line(colours("red"))+
theme_classic()+
facet_grid()
grahp1<-ggplot(data_clean_ocu,aes(x=age,y=yhat_reg2))+
geom_line()+
theme_classic()+
facet_grid()
grahp1<-ggplot(data_clean_ocu,aes(x=age,y=yhat_reg2))+
geom_line(colour="red")+
theme_classic()+
facet_grid()
grahp1<-ggplot(data_clean_ocu,aes(x=age,y=yhat_reg2))+
geom_line(colour="red")+
theme_classic()+
facet_grid()
ggplot(data_clean_ocu,aes(x=age,y=yhat_reg2))+
geom_line(colour="red")+
theme_classic()+
facet_grid()
ggplot(data_clean_ocu,aes(x=age,y=yhat_reg2))+
geom_line(colour="red")+
theme_classic()+
facet_grid()+
ggtitle("Modelo Ingreso ajustado por edad")
ggplot(data_clean_ocu,aes(x=age,y=yhat_reg2))+
geom_line(colour="red")+
theme_classic()+
facet_grid()+
ggtitle("Modelo Ingreso ajustado por edad")+
theme(plot.title = element_text(hjust = 0.5))
ggplot(data_clean_ocu,aes(x=age,y=yhat_reg2))+
geom_line(colour="red")+
theme_classic()+
facet_grid()+
ggtitle("Modelo Ingreso ajustado por edad")+
theme(plot.title = element_text(hjust = 0.5))+
labs(x="Edad", y="Ingreso")
stargazer(reg1,reg2,type="text")
ggplot(data_clean_ocu,aes(x=age))+
geom_line(aes(y=yhat_reg2),colour="red")+
geom_line(aes(y=y_total_m),colour="blue")+
theme_classic()+
facet_grid()+
ggtitle("Modelo Ingreso ajustado por edad")+
theme(plot.title = element_text(hjust = 0.5))+
labs(x="Edad", y="Ingreso")
ggplot(data_clean_ocu,aes(x=age))+
geom_line(aes(y=yhat_reg2),colour="red")+
geom_point(aes(y=y_total_m),colour="blue")+
theme_classic()+
facet_grid()+
ggtitle("Modelo Ingreso ajustado por edad")+
theme(plot.title = element_text(hjust = 0.5))+
labs(x="Edad", y="Ingreso")
ggplot(data_clean_ocu,aes(x=age))+
geom_line(aes(y=yhat_reg2),colour="red")+
theme_classic()+
facet_grid()+
ggtitle("Modelo Ingreso ajustado por edad")+
theme(plot.title = element_text(hjust = 0.5))+
labs(x="Edad", y="Ingreso")
stargazer(reg1,reg2,type="text")
stargazer(reg1,reg2)
stargazer(reg1,reg2,type="text")
eta_mod2.fn <-function(data_clean_ocu,index,
age_bar=mean(data_clean_ocu$age),
agesqr_bar=mean(data_clean_ocu$agesqr))
{
f<-lm(y_total_m~age+ agesqr,data_clean_ocu ,  subset = index)
coefs<-f$coefficients
b2<-coefs[2]
b3<-coefs[3]
age<- -b2/(2*b3)
return(age)}
results <- boot(data=data_clean_ocu, eta_mod2.fn,R=1000)
results
ic <- boot.ci(results,conf = 0.95, type="norm")
ic
ggplot(data_clean_ocu,aes(x=age))+
geom_line(aes(y=yhat_reg_gap),colour="red")+
geom_line(aes(y=yhat_reg_fem),colour="violet")+
geom_line(aes(y=yhat_reg_male),colour="blue")+
theme_classic()+
facet_grid()+
ggtitle("Modelo Ingreso ajustado por edad")+
theme(plot.title = element_text(hjust = 0.5))+
labs(x="Edad", y="Ingreso")
### Si quisieramos observar efectos por género
data_clean_ocu_fem <- data_clean_ocu
data_clean_ocu_fem$female <- with(data_clean_ocu_fem, ifelse(
sex == 1, 0, 1))
data_clean_ocu_fem<- subset(data_clean_ocu_fem, data_clean_ocu_fem$female==1)
data_clean_ocu_male<- subset(data_clean_ocu, data_clean_ocu$sex==1)
data_clean_ocu_male$male <- with(data_clean_ocu_male, ifelse(
sex == 1, 0, 1))
reg_gap <- lm( LnIng~ age+ agesqr+female  , data=data_clean_ocu_fem)
reg_ing_fem <- lm( y_total_m~age+ agesqr+female  , data=data_clean_ocu_fem)
reg_ing_male <- lm( y_total_m~age+ agesqr+male  , data=data_clean_ocu_male)
data_clean_ocu_fem$yhat_reg_gap<-predict(reg_gap)
data_clean_ocu_fem$yhat_reg_fem<-predict(reg_ing_fem)
data_clean_ocu_male$yhat_reg_male<-predict(reg_ing_male)
stargazer(reg_gap,reg_ing_fem,reg_ing_male,type="text")
ggplot(data_clean_ocu,aes(x=age))+
geom_line(aes(y=yhat_reg_gap),colour="red")+
geom_line(aes(y=yhat_reg_fem),colour="violet")+
geom_line(aes(y=yhat_reg_male),colour="blue")+
theme_classic()+
facet_grid()+
ggtitle("Modelo Ingreso ajustado por edad")+
theme(plot.title = element_text(hjust = 0.5))+
labs(x="Edad", y="Ingreso")
ggplot(data_clean_ocu_fem,aes(x=age))+
geom_line(aes(y=yhat_reg_gap),colour="red")+
geom_line(aes(y=yhat_reg_fem),colour="violet")+
theme_classic()+
facet_grid()+
ggtitle("Modelo Ingreso ajustado por edad")+
theme(plot.title = element_text(hjust = 0.5))+
labs(x="Edad", y="Ingreso")
ggplot(data_clean_ocu_fem,aes(x=age))+
geom_line(aes(y=yhat_reg_fem),colour="violet")+
theme_classic()+
facet_grid()+
ggtitle("Modelo Ingreso ajustado por edad")+
theme(plot.title = element_text(hjust = 0.5))+
labs(x="Edad", y="Ingreso")
ggplot(data_clean_ocu_fem,aes(x=age))+
geom_line(aes(y=yhat_reg_gap),colour="violet")+
theme_classic()+
facet_grid()+
ggtitle("Modelo Ingreso ajustado por edad")+
theme(plot.title = element_text(hjust = 0.5))+
labs(x="Edad", y="Ingreso")
data_clean_ocu_fem <- data_clean_ocu
data_clean_ocu_fem$female <- with(data_clean_ocu_fem, ifelse(
sex == 1, 0, 1))
data_clean_ocu_fem<- subset(data_clean_ocu_fem, data_clean_ocu_fem$female==1)
data_clean_ocu_male<- subset(data_clean_ocu, data_clean_ocu$sex==1)
data_clean_ocu_male$male <- with(data_clean_ocu_male, ifelse(
sex == 1, 0, 1))
reg_gap <- lm( LnIng~ age+ agesqr+female  , data=data_clean_ocu_fem)
reg_ingreso<- lm( LnIng~ age+ agesqr  , data=data_clean_ocu_male)
reg_ing_fem <- lm( y_total_m~age+ agesqr+female  , data=data_clean_ocu_fem)
reg_ing_male <- lm( y_total_m~age+ agesqr+male  , data=data_clean_ocu_male)
data_clean_ocu_fem$yhat_reg_gap<-predict(reg_gap)
data_clean_ocu_fem$yhat_reg_fem<-predict(reg_ing_fem)
data_clean_ocu_male$yhat_reg_male<-predict(reg_ing_male)
stargazer(reg_gap,reg_ing_fem,reg_ing_male,type="text")
plot(data_clean_ocu_fem$age,data_clean_ocu_fem$yhat_reg_gap)
plot(data_clean_ocu_fem$age,data_clean_ocu_fem$yhat_reg_fem)
plot(data_clean_ocu_male$age,data_clean_ocu_male$yhat_reg_male)
### Si quisieramos observar efectos por género
data_clean_ocu_fem <- data_clean_ocu
data_clean_ocu_fem$female <- with(data_clean_ocu_fem, ifelse(
sex == 1, 0, 1))
data_clean_ocu_fem<- subset(data_clean_ocu_fem, data_clean_ocu_fem$female==1)
data_clean_ocu_male<- subset(data_clean_ocu, data_clean_ocu$sex==1)
data_clean_ocu_male$male <- with(data_clean_ocu_male, ifelse(
sex == 1, 0, 1))
reg_gap <- lm( LnIng~ age+ agesqr+female  , data=data_clean_ocu_fem)
reg_ingreso<- lm( LnIng~ age+ agesqr  , data=data_clean_ocu_male)
reg_ing_fem <- lm( y_total_m~age+ agesqr+female  , data=data_clean_ocu_fem)
reg_ing_male <- lm( y_total_m~age+ agesqr+male  , data=data_clean_ocu_male)
data_clean_ocu_fem$yhat_reg_gap<-predict(reg_gap)
data_clean_ocu_fem$yhat_reg_fem<-predict(reg_ing_fem)
data_clean_ocu_male$yhat_reg_male<-predict(reg_ing_male)
data_clean_ocu_male$yhat_reg_gapmale<-predict(reg_ingreso)
stargazer(reg_gap,reg_ing_fem,reg_ing_male,type="text")
ggplot(data_clean_ocu_fem,aes(x=age))+
geom_line(aes(y=yhat_reg_gap),colour="violet")+
geom_line(data=data_clean_ocu_male,aes(y=yhat_reg_gapmale),colour="red")+
theme_classic()+
facet_grid()+
ggtitle("Modelo Ingreso ajustado por edad")+
theme(plot.title = element_text(hjust = 0.5))+
labs(x="Edad", y="Ingreso")
ggplot(data_clean_ocu_fem,aes(x=age))+
geom_line(aes(y=yhat_reg_gap),colour="yhat_reg_gap")+
geom_line(data=data_clean_ocu_male,aes(y=yhat_reg_gapmale),colour="yhat_reg_gapmale")+
theme_classic()+
facet_grid()+
ggtitle("Modelo Ingreso analizado por género")+
theme(plot.title = element_text(hjust = 0.5))+
labs(x="Edad", y="Ingreso")+
scale_color_manual(name = "Género", values = c("yhat_reg_gapmale" = "red", "yhat_reg_gap" = "violet"))
ggplot(data_clean_ocu_fem,aes(x=age))+
geom_line(aes(y=yhat_reg_gap,colour="yhat_reg_gap"), size=1)+
geom_line(data=data_clean_ocu_male,aes(y=yhat_reg_gapmale,colour="yhat_reg_gapmale"), size=1)+
theme_classic()+
facet_grid()+
ggtitle("Modelo Ingreso analizado por género")+
theme(plot.title = element_text(hjust = 0.5))+
labs(x="Edad", y="Ingreso")+
scale_color_manual(name = "Género", values = c("yhat_reg_gapmale" = "red", "yhat_reg_gap" = "violet"))
ggplot(data_clean_ocu_fem,aes(x=age))+
geom_line(aes(y=yhat_reg_gap,colour="Femenino"), size=1)+
geom_line(data=data_clean_ocu_male,aes(y=yhat_reg_gapmale,colour="Masculino"), size=1)+
theme_classic()+
facet_grid()+
ggtitle("Modelo Ingreso analizado por género")+
theme(plot.title = element_text(hjust = 0.5))+
labs(x="Edad", y="Ingreso")+
scale_color_manual(name = "Género", values = c("Masculino" = "red", "Femenino" = "violet"))
eta_modfem.fn <-function(data_clean_ocu_fem,index,
age_barfem=mean(data_clean_ocu_fem$age),
agesqr_barfem=mean(data_clean_ocu_fem$agesqr))
{
fem<-lm(y_total_m~age+ agesqr,data_clean_ocu_fem ,  subset = index)
coefs_fem<-fem$coefficients
b2_fem<-coefs_fem[2]
b3_fem<-coefs_fem[3]
age_fem<- -b2_fem/(2*b3_fem)
return(age_fem)}
results_fem <- boot(data=data_clean_ocu_fem, eta_modfem.fn,R=1000)
results_fem
ic_fem <- boot.ci(results_fem,conf = 0.95, type="norm")
ic_fem
eta_modmale.fn <-function(data_clean_ocu_male,index,
age_barfem=mean(data_clean_ocu_male$age),
agesqr_barfem=mean(data_clean_ocu_male$agesqr))
{
male<-lm(y_total_m~age+ agesqr,data_clean_ocu_male ,  subset = index)
coefs_male<-male$coefficients
b2_male<-coefs_male[2]
b3_male<-coefs_male[3]
age_male<- -b2_male/(2*b3_male)
return(age_male)}
results_male <- boot(data=data_clean_ocu_male, eta_modmale.fn,R=1000)
results_male
ic_male <- boot.ci(results_male,conf = 0.95, type="norm")
ic_male
